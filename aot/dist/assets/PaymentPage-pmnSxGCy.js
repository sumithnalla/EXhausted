const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-xu_aWE4V.js","assets/index-_xaENS7O.js","assets/index-CQUZF9b3.css"])))=>i.map(i=>d[i]);
var es=Object.defineProperty;var ts=(r,e,t)=>e in r?es(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Se=(r,e,t)=>ts(r,typeof e!="symbol"?e+"":e,t);import{c as ss,_ as de,g as rs,a as q,u as St,r as E,j as o,b as et,I as R,e as ns,d as is,X as as,R as os,f as ls}from"./index-_xaENS7O.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=ss("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),hs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class tt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ds extends tt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class us extends tt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class fs extends tt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var He;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(He||(He={}));var gs=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};class ps{constructor(e,{headers:t={},customFetch:s,region:n=He.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=hs(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return gs(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let l={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(l["x-region"]=c);let h;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(l["Content-Type"]="text/plain",h=a):typeof FormData<"u"&&a instanceof FormData?h=a:(l["Content-Type"]="application/json",h=JSON.stringify(a)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:h}).catch(p=>{throw new ds(p)}),u=d.headers.get("x-relay-error");if(u&&u==="true")throw new us(d);if(!d.ok)throw new fs(d);let f=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield d.json():f==="application/octet-stream"?g=yield d.blob():f==="text/event-stream"?g=d:f==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null}}catch(n){return{data:null,error:n}}})}}var L={},st={},$e={},xe={},Oe={},Ce={},ms=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ue=ms();const ys=ue.fetch,Tt=ue.fetch.bind(ue),Nt=ue.Headers,vs=ue.Request,ws=ue.Response,fe=Object.freeze(Object.defineProperty({__proto__:null,Headers:Nt,Request:vs,Response:ws,default:Tt,fetch:ys},Symbol.toStringTag,{value:"Module"})),bs=rs(fe);var Re={};Object.defineProperty(Re,"__esModule",{value:!0});let _s=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Re.default=_s;var Et=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ce,"__esModule",{value:!0});const xs=Et(bs),js=Et(Re);let ks=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=xs.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,l,c;let h=null,d=null,u=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const T=await i.text();T===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?d=T:d=JSON.parse(T))}const m=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),w=(l=i.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");m&&w&&w.length>1&&(u=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(h={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,u=null,f=406,g="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const m=await i.text();try{h=JSON.parse(m),Array.isArray(h)&&i.status===404&&(d=[],h=null,f=200,g="OK")}catch{i.status===404&&m===""?(f=204,g="No Content"):h={message:m}}if(h&&this.isMaybeSingle&&(!((c=h==null?void 0:h.details)===null||c===void 0)&&c.includes("0 rows"))&&(h=null,f=200,g="OK"),h&&this.shouldThrowOnError)throw new js.default(h)}return{error:h,data:d,count:u,status:f,statusText:g}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,l,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};Ce.default=ks;var Ss=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Oe,"__esModule",{value:!0});const Ts=Ss(Ce);let Ns=class extends Ts.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",l=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),h=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${h}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Oe.default=Ns;var Es=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(xe,"__esModule",{value:!0});const Ps=Es(Oe);let As=class extends Ps.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};xe.default=As;var $s=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($e,"__esModule",{value:!0});const me=$s(xe);let Os=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new me.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new me.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const a="POST",l=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),i||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const c=e.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(c.length>0){const h=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new me.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new me.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new me.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};$e.default=Os;var Ie={},Le={};Object.defineProperty(Le,"__esModule",{value:!0});Le.version=void 0;Le.version="0.0.0-automated";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.DEFAULT_HEADERS=void 0;const Cs=Le;Ie.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Cs.version}`};var Pt=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(st,"__esModule",{value:!0});const Rs=Pt($e),Is=Pt(xe),Ls=Ie;let Us=class At{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ls.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Rs.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new At(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let a;const l=new URL(`${this.url}/rpc/${e}`);let c;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([d,u])=>u!==void 0).map(([d,u])=>[d,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([d,u])=>{l.searchParams.append(d,u)})):(a="POST",c=t);const h=Object.assign({},this.headers);return i&&(h.Prefer=`count=${i}`),new Is.default({method:a,url:l,headers:h,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};st.default=Us;var ge=q&&q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(L,"__esModule",{value:!0});L.PostgrestError=L.PostgrestBuilder=L.PostgrestTransformBuilder=L.PostgrestFilterBuilder=L.PostgrestQueryBuilder=L.PostgrestClient=void 0;const $t=ge(st);L.PostgrestClient=$t.default;const Ot=ge($e);L.PostgrestQueryBuilder=Ot.default;const Ct=ge(xe);L.PostgrestFilterBuilder=Ct.default;const Rt=ge(Oe);L.PostgrestTransformBuilder=Rt.default;const It=ge(Ce);L.PostgrestBuilder=It.default;const Lt=ge(Re);L.PostgrestError=Lt.default;var Ds=L.default={PostgrestClient:$t.default,PostgrestQueryBuilder:Ot.default,PostgrestFilterBuilder:Ct.default,PostgrestTransformBuilder:Rt.default,PostgrestBuilder:It.default,PostgrestError:Lt.default};const{PostgrestClient:Bs,PostgrestQueryBuilder:Mn,PostgrestFilterBuilder:zn,PostgrestTransformBuilder:Jn,PostgrestBuilder:Hn,PostgrestError:Kn}=Ds,qs="2.11.2",Fs={"X-Client-Info":`realtime-js/${qs}`},Ms="1.0.0",Ut=1e4,zs=1e3;var he;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(he||(he={}));var D;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(D||(D={}));var F;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(F||(F={}));var Ke;(function(r){r.websocket="websocket"})(Ke||(Ke={}));var te;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(te||(te={}));class Js{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const l=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const h=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:c,payload:h}}}class Dt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var k;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(k||(k={}));const lt=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=Hs(a,r,e,n),i),{})},Hs=(r,e,t,s)=>{const n=e.find(l=>l.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?Bt(i,a):Ge(a)},Bt=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Ws(e,t)}switch(r){case k.bool:return Ks(e);case k.float4:case k.float8:case k.int2:case k.int4:case k.int8:case k.numeric:case k.oid:return Gs(e);case k.json:case k.jsonb:return Vs(e);case k.timestamp:return Qs(e);case k.abstime:case k.date:case k.daterange:case k.int4range:case k.int8range:case k.money:case k.reltime:case k.text:case k.time:case k.timestamptz:case k.timetz:case k.tsrange:case k.tstzrange:return Ge(e);default:return Ge(e)}},Ge=r=>r,Ks=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Gs=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Vs=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Ws=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(l=>Bt(e,l))}return r},Qs=r=>typeof r=="string"?r.replace(" ","T"):r,qt=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Be{constructor(e,t,s={},n=Ut){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ct;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(ct||(ct={}));class ve{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ve.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=ve.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],l()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ve.syncDiff(this.state,n,i,a),l())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),l={},c={};return this.map(i,(h,d)=>{a[h]||(c[h]=d)}),this.map(a,(h,d)=>{const u=i[h];if(u){const f=d.map(w=>w.presence_ref),g=u.map(w=>w.presence_ref),p=d.filter(w=>g.indexOf(w.presence_ref)<0),m=u.filter(w=>f.indexOf(w.presence_ref)<0);p.length>0&&(l[h]=p),m.length>0&&(c[h]=m)}else l[h]=d}),this.syncDiff(i,{joins:l,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(l,c)=>{var h;const d=(h=e[l])!==null&&h!==void 0?h:[];if(e[l]=this.cloneDeep(c),d.length>0){const u=e[l].map(g=>g.presence_ref),f=d.filter(g=>u.indexOf(g.presence_ref)<0);e[l].unshift(...f)}s(l,d,c)}),this.map(a,(l,c)=>{let h=e[l];if(!h)return;const d=c.map(u=>u.presence_ref);h=h.filter(u=>d.indexOf(u.presence_ref)<0),e[l]=h,n(l,h,c),h.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ht;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ht||(ht={}));var dt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(dt||(dt={}));var H;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(H||(H={}));class rt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=D.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Be(this,F.join,this.params,this.timeout),this.rejoinTimer=new Dt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=D.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=D.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this._on(F.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new ve(this),this.broadcastEndpointURL=qt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:l}}=this.params;this._onError(d=>e==null?void 0:e(H.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(H.CLOSED));const c={},h={broadcast:i,presence:a,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&n!==void 0?n:[],private:l};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:h},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var u;if(this.socket.setAuth(),d===void 0){e==null||e(H.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(u=f==null?void 0:f.length)!==null&&u!==void 0?u:0,p=[];for(let m=0;m<g;m++){const w=f[m],{filter:{event:T,schema:_,table:j,filter:S}}=w,P=d&&d[m];if(P&&P.event===T&&P.schema===_&&P.table===j&&P.filter===S)p.push(Object.assign(Object.assign({},w),{id:P.id}));else{this.unsubscribe(),e==null||e(H.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(H.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(H.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(H.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=h.body)===null||n===void 0?void 0:n.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,l,c;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),h.receive("ok",()=>i("ok")),h.receive("error",()=>i("error")),h.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=D.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(F.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new Be(this,F.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Be(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:l,error:c,leave:h,join:d}=F;if(s&&[l,c,h,d].indexOf(a)>=0&&s!==this._joinRef())return;let f=this._onMessage(a,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(g=>{var p,m,w;return((p=g.filter)===null||p===void 0?void 0:p.event)==="*"||((w=(m=g.filter)===null||m===void 0?void 0:m.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===a}).map(g=>g.callback(f,s)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var p,m,w,T,_,j;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const S=g.id,P=(p=g.filter)===null||p===void 0?void 0:p.event;return S&&((m=t.ids)===null||m===void 0?void 0:m.includes(S))&&(P==="*"||(P==null?void 0:P.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const S=(_=(T=g==null?void 0:g.filter)===null||T===void 0?void 0:T.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return S==="*"||S===((j=t==null?void 0:t.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:w,commit_timestamp:T,type:_,errors:j}=p;f=Object.assign(Object.assign({},{schema:m,table:w,commit_timestamp:T,eventType:_,new:{},old:{},errors:j}),this._getPayloadRecords(p))}g.callback(f,s)})}_isClosed(){return this.state===D.closed}_isJoined(){return this.state===D.joined}_isJoining(){return this.state===D.joining}_isLeaving(){return this.state===D.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&rt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(F.close,{},e)}_onError(e){this._on(F.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=D.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=lt(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=lt(e.columns,e.old_record)),t}}const Ys=()=>{},Xs=typeof WebSocket<"u",Zs=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class er{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Fs,this.params={},this.timeout=Ut,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ys,this.conn=null,this.sendBuffer=[],this.serializer=new Js,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...l)=>de(async()=>{const{default:c}=await Promise.resolve().then(()=>fe);return{default:c}},void 0).then(({default:c})=>c(...l)):a=fetch,(...l)=>a(...l)},this.endPoint=`${e}/${Ke.websocket}`,this.httpEndpoint=qt(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Dt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Xs){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new tr(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),de(async()=>{const{default:e}=await import("./browser-xu_aWE4V.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1,2])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ms}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case he.connecting:return te.Connecting;case he.open:return te.Open;case he.closing:return te.Closing;default:return te.Closed}}isConnected(){return this.connectionState()===te.Open}channel(e,t={config:{}}){const s=new rt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(F.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(zs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(l=>l._isMember(s)).forEach(l=>l._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(l=>l(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(F.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Zs],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class tr{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=he.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class nt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function A(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class sr extends nt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ve extends nt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var rr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};const Ft=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},nr=()=>rr(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield de(()=>Promise.resolve().then(()=>fe),void 0)).Response:Response}),We=r=>{if(Array.isArray(r))return r.map(t=>We(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=We(s)}),e};var se=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};const qe=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ir=(r,e,t)=>se(void 0,void 0,void 0,function*(){const s=yield nr();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new sr(qe(n),r.status||500))}).catch(n=>{e(new Ve(qe(n),n))}):e(new Ve(qe(r),r))}),ar=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function je(r,e,t,s,n,i){return se(this,void 0,void 0,function*(){return new Promise((a,l)=>{r(t,ar(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>ir(c,l,s))})})}function Ae(r,e,t,s){return se(this,void 0,void 0,function*(){return je(r,"GET",e,t,s)})}function W(r,e,t,s,n){return se(this,void 0,void 0,function*(){return je(r,"POST",e,s,n,t)})}function or(r,e,t,s,n){return se(this,void 0,void 0,function*(){return je(r,"PUT",e,s,n,t)})}function lr(r,e,t,s){return se(this,void 0,void 0,function*(){return je(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Mt(r,e,t,s,n){return se(this,void 0,void 0,function*(){return je(r,"DELETE",e,s,n,t)})}var I=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};const cr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ut={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class hr{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Ft(n)}uploadOrUpdate(e,t,s,n){return I(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},ut),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(l=Object.assign(Object.assign({},l),n.headers));const h=this._removeEmptyFolders(t),d=this._getFinalPath(h),u=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:l},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield u.json();return u.ok?{data:{path:h,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(A(i))return{data:null,error:i};throw i}})}upload(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return I(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",t);try{let c;const h=Object.assign({upsert:ut.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",h.cacheControl)):(c=s,d["cache-control"]=`max-age=${h.cacheControl}`,d["content-type"]=h.contentType);const u=yield this.fetch(l.toString(),{method:"PUT",body:c,headers:d}),f=yield u.json();return u.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(A(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return I(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield W(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),l=a.searchParams.get("token");if(!l)throw new nt("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}update(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}copy(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:{path:(yield W(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return I(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield W(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return I(this,void 0,void 0,function*(){try{const n=yield W(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}download(e,t){return I(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield Ae(this.fetch,`${this.url}/${n}/${l}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(A(l))return{data:null,error:l};throw l}})}info(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Ae(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:We(s),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}exists(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield lr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(A(s)&&s instanceof Ve){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let h=n.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${s}${h}`)}}}remove(e){return I(this,void 0,void 0,function*(){try{return{data:yield Mt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}list(e,t,s){return I(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},cr),t),{prefix:e||""});return{data:yield W(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const dr="2.7.1",ur={"X-Client-Info":`storage-js/${dr}`};var ae=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};class fr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},ur),t),this.fetch=Ft(s)}listBuckets(){return ae(this,void 0,void 0,function*(){try{return{data:yield Ae(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}})}getBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield Ae(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ae(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ae(this,void 0,void 0,function*(){try{return{data:yield or(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield W(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ae(this,void 0,void 0,function*(){try{return{data:yield Mt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}}class gr extends fr{constructor(e,t={},s){super(e,t,s)}from(e){return new hr(this.url,this.headers,e,this.fetch)}}const pr="2.49.8";let ye="";typeof Deno<"u"?ye="deno":typeof document<"u"?ye="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ye="react-native":ye="node";const mr={"X-Client-Info":`supabase-js-${ye}/${pr}`},yr={headers:mr},vr={schema:"public"},wr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},br={};var _r=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};const xr=r=>{let e;return r?e=r:typeof fetch>"u"?e=Tt:e=fetch,(...t)=>e(...t)},jr=()=>typeof Headers>"u"?Nt:Headers,kr=(r,e,t)=>{const s=xr(t),n=jr();return(i,a)=>_r(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:r;let h=new n(a==null?void 0:a.headers);return h.has("apikey")||h.set("apikey",r),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:h}))})};var Sr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};function Tr(r){return r.endsWith("/")?r:r+"/"}function Nr(r,e){var t,s;const{db:n,auth:i,realtime:a,global:l}=r,{db:c,auth:h,realtime:d,global:u}=e,f={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},h),i),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},u),l),{headers:Object.assign(Object.assign({},(t=u==null?void 0:u.headers)!==null&&t!==void 0?t:{}),(s=l==null?void 0:l.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>Sr(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const zt="2.69.1",ce=30*1e3,Qe=3,Fe=Qe*ce,Er="http://localhost:9999",Pr="supabase.auth.token",Ar={"X-Client-Info":`gotrue-js/${zt}`},Ye="X-Supabase-Api-Version",Jt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$r=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Or=6e5;class it extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function v(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Cr extends it{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Rr(r){return v(r)&&r.name==="AuthApiError"}class Ht extends it{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Y extends it{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class G extends Y{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ir(r){return v(r)&&r.name==="AuthSessionMissingError"}class Me extends Y{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Te extends Y{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ne extends Y{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Lr(r){return v(r)&&r.name==="AuthImplicitGrantRedirectError"}class ft extends Y{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xe extends Y{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ze(r){return v(r)&&r.name==="AuthRetryableFetchError"}class gt extends Y{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class we extends Y{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),mt=` 	
\r=`.split(""),Ur=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<mt.length;e+=1)r[mt[e].charCodeAt(0)]=-2;for(let e=0;e<pt.length;e+=1)r[pt[e].charCodeAt(0)]=e;return r})();function Kt(r,e,t){const s=Ur[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function yt(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=a=>{qr(a,s,t)};for(let a=0;a<r.length;a+=1)Kt(r.charCodeAt(a),n,i);return e.join("")}function Dr(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Br(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Dr(s,e)}}function qr(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Fr(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Kt(r.charCodeAt(n),t,s);return new Uint8Array(e)}function Mr(r){const e=[];return Br(r,t=>e.push(t)),new Uint8Array(e)}function zr(r){return Math.round(Date.now()/1e3)+r}function Jr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const z=()=>typeof window<"u"&&typeof document<"u",Z={tested:!1,writable:!1},be=()=>{if(!z())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Z.tested)return Z.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Z.tested=!0,Z.writable=!0}catch{Z.tested=!0,Z.writable=!1}return Z.writable};function Hr(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Gt=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>fe);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Kr=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Vt=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Ee=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Pe=async(r,e)=>{await r.removeItem(e)};class Ue{constructor(){this.promise=new Ue.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ue.promiseConstructor=Promise;function Je(r){const e=r.split(".");if(e.length!==3)throw new we("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!$r.test(e[s]))throw new we("JWT not in base64url format");return{header:JSON.parse(yt(e[0])),payload:JSON.parse(yt(e[1])),signature:Fr(e[2]),raw:{header:e[0],payload:e[1]}}}async function Gr(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Vr(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function Wr(r){return("0"+r.toString(16)).substr(-2)}function Qr(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,Wr).join("")}async function Yr(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Xr(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Yr(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function oe(r,e,t=!1){const s=Qr();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Vt(r,`${e}-code-verifier`,n);const i=await Xr(s);return[i,s===i?"plain":"s256"]}const Zr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function en(r){const e=r.headers.get(Ye);if(!e||!e.match(Zr))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function tn(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function sn(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var rn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const ee=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),nn=[502,503,504];async function vt(r){var e;if(!Kr(r))throw new Xe(ee(r),0);if(nn.includes(r.status))throw new Xe(ee(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ht(ee(i),i)}let s;const n=en(r);if(n&&n.getTime()>=Jt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new gt(ee(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new G}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new gt(ee(t),r.status,t.weak_password.reasons);throw new Cr(ee(t),r.status||500,s)}const an=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function b(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Ye]||(i[Ye]=Jt["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await on(r,e,t+l,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function on(r,e,t,s,n,i){const a=an(e,s,n,i);let l;try{l=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new Xe(ee(c),0)}if(l.ok||await vt(l),s!=null&&s.noResolveJson)return l;try{return await l.json()}catch(c){await vt(c)}}function V(r){var e;let t=null;dn(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=zr(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function wt(r){const e=V(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Q(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ln(r){return{data:r,error:null}}function cn(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=rn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:l,user:c},error:null}}function hn(r){return r}function dn(r){return r.access_token&&r.refresh_token&&r.expires_in}var un=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class fn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Gt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await b(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(v(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await b(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Q})}catch(s){if(v(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=un(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await b(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:cn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(v(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await b(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Q})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,l,c;try{const h={nextPage:null,lastPage:0,total:0},d=await b(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:hn});if(d.error)throw d.error;const u=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(p.split(";")[1].split("=")[1]);h[`${w}Page`]=m}),h.total=parseInt(f)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(v(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){try{return await b(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Q})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await b(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Q})}catch(s){if(v(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await b(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Q})}catch(s){if(v(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await b(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(v(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await b(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(v(t))return{data:null,error:t};throw t}}}const gn={getItem:r=>be()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{be()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{be()&&globalThis.localStorage.removeItem(r)}};function bt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function pn(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const le={debug:!!(globalThis&&be()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Wt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class mn extends Wt{}async function yn(r,e,t){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),le.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){le.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{le.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw le.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new mn(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(le.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}pn();const vn={url:Er,storageKey:Pr,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ar,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function _t(r,e,t){return await t()}class _e{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=_e.nextInstanceID,_e.nextInstanceID+=1,this.instanceID>0&&z()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},vn),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new fn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Gt(n.fetch),this.lock=n.lock||_t,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:z()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=yn:this.lock=_t,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:be()?this.storage=gn:(this.memoryStorage={},this.storage=bt(this.memoryStorage)):(this.memoryStorage={},this.storage=bt(this.memoryStorage)),z()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${zt}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Hr(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),z()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Lr(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return v(t)?{error:t}:{error:new Ht("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:V}),{data:a,error:l}=i;if(l||!a)return{data:{user:null,session:null},error:l};const c=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(i){if(v(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:d,password:u,options:f}=e;let g=null,p=null;this.flowType==="pkce"&&([g,p]=await oe(this.storage,this.storageKey)),i=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:u,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:p},xform:V})}else if("phone"in e){const{phone:d,password:u,options:f}=e;i=await b(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:V})}else throw new Te("You must provide either an email or phone number and a password");const{data:a,error:l}=i;if(l||!a)return{data:{user:null,session:null},error:l};const c=a.session,h=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(i){if(v(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:l}=e;t=await b(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:wt})}else if("phone"in e){const{phone:i,password:a,options:l}=e;t=await b(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:wt})}else throw new Te("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Me}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ee(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await b(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:V});if(await Pe(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Me}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(v(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,l=await b(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:V}),{data:c,error:h}=l;return h?{data:{user:null,session:null},error:h}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Me}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:h})}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:l,options:c}=e;let h=null,d=null;this.flowType==="pkce"&&([h,d]=await oe(this.storage,this.storageKey));const{error:u}=await b(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:h,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:l,options:c}=e,{data:h,error:d}=await b(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:d}}throw new Te("You must provide either an email or phone number.")}catch(l){if(v(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:l}=await b(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:V});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,h=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await oe(this.storage,this.storageKey)),await b(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:ln})}catch(i){if(v(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new G;const{error:n}=await b(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(v(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await b(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:l}=await b(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:l}}throw new Te("You must provide either an email or phone number and a type")}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ee(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Fe:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,h,d)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,h,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await b(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Q}):await this._useSession(async t=>{var s,n,i;const{data:a,error:l}=t;if(l)throw l;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new G}:await b(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Q})})}catch(t){if(v(t))return Ir(t)&&(await this._removeSession(),await Pe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new G;const a=n.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await oe(this.storage,this.storageKey));const{data:h,error:d}=await b(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Q});if(d)throw d;return a.user=h.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(v(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new G;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:a}=Je(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(v(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:l}=t;if(l)throw l;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new G;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!z())throw new Ne("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ne(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new ft("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ne("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ft("No code detected.");const{data:_,error:j}=await this._exchangeCodeForSession(e.code);if(j)throw j;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:l,expires_at:c,token_type:h}=e;if(!i||!l||!a||!h)throw new Ne("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(l);let f=d+u;c&&(f=parseInt(c));const g=f-d;g*1e3<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const p=f-u;d-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,d):d-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,d);const{data:m,error:w}=await this._getUser(i);if(w)throw w;const T={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:u,expires_at:f,refresh_token:a,token_type:h,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:T,redirectType:e.type},error:null}}catch(s){if(v(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ee(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:l}=await this.admin.signOut(a,e);if(l&&!(Rr(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Pe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Jr(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await oe(this.storage,this.storageKey,!0));try{return await b(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(v(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(v(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,l,c,h,d;const{data:u,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await b(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(h=u.session)===null||h===void 0?void 0:h.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return z()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(v(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await b(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(v(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Vr(async n=>(n>0&&await Gr(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await b(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:V})),(n,i)=>{const a=200*Math.pow(2,n);return i&&ze(i)&&Date.now()+a-s<ce})}catch(s){if(this._debug(t,"error",s),v(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),z()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ee(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Fe;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Fe}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),ze(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new G;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Ue;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new G;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(n,"error",i),v(i)){const a={session:null,error:i};return ze(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Vt(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Pe(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&z()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ce);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/ce);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ce}ms, refresh threshold is ${Qe} ticks`),n<=Qe&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Wt)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!z()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await oe(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(l.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await b(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(v(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:h}=await b(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(v(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:l}=await b(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(t){if(v(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await b(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(v(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Je(n.access_token);let l=null;a.aal&&(l=a.aal);let c=l;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s||(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+Or>Date.now()))return s;const{data:n,error:i}=await b(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new we("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),s=n.keys.find(a=>a.kid===e),!s)throw new we("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:g,error:p}=await this.getSession();if(p||!g.session)return{data:null,error:p};s=g.session.access_token}const{header:n,payload:i,signature:a,raw:{header:l,payload:c}}=Je(s);if(tn(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:i,header:n,signature:a},error:null}}const h=sn(n.alg),d=await this.fetchJwk(n.kid,t),u=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,u,a,Mr(`${l}.${c}`)))throw new we("Invalid JWT signature");return{data:{claims:i,header:n,signature:a},error:null}}catch(s){if(v(s))return{data:null,error:s};throw s}}}_e.nextInstanceID=0;const wn=_e;class bn extends wn{constructor(e){super(e)}}var _n=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function l(d){try{h(s.next(d))}catch(u){a(u)}}function c(d){try{h(s.throw(d))}catch(u){a(u)}}function h(d){d.done?i(d.value):n(d.value).then(l,c)}h((s=s.apply(r,e||[])).next())})};class xn{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=Tr(e),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const h=`sb-${c.hostname.split(".")[0]}-auth-token`,d={db:vr,realtime:br,auth:Object.assign(Object.assign({},wr),{storageKey:h}),global:yr},u=Nr(s??{},d);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=kr(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Bs(new URL("rest/v1",c).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new ps(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new gr(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return _n(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:l,debug:c},h,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bn({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),h),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new er(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const jn=(r,e,t)=>new xn(r,e,t),kn=void 0,Sn=void 0;throw new Error("Missing Supabase environment variables");const Ze=jn(kn,Sn,{auth:{persistSession:!0,autoRefreshToken:!0}}),Qt=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),Yt=r=>/^[0-9]{10}$/.test(r),Xt=r=>r.trim().length>=2&&r.trim().length<=50,Tn=(r,e)=>r>=1&&r<=e,B=r=>r.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim(),xt=r=>{const e=new Date(r),t=new Date;return t.setHours(0,0,0,0),e>=t},Nn=r=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r);class Zt{constructor(e=10,t=6e4){Se(this,"storage",new Map);Se(this,"maxRequests");Se(this,"windowMs");this.maxRequests=e,this.windowMs=t}isAllowed(e){const t=Date.now(),s=this.storage.get(e);return!s||t>s.resetTime?(this.storage.set(e,{count:1,resetTime:t+this.windowMs}),!0):s.count>=this.maxRequests?!1:(s.count++,!0)}getRemainingTime(e){const t=this.storage.get(e);return t?Math.max(0,t.resetTime-Date.now()):0}}const jt=new Zt(5,3e5),kt=new Zt(10,6e4),En=({venue:r,venueId:e,onSubmit:t,loading:s,error:n,formData:i,setFormData:a,selectedDate:l,setSelectedDate:c})=>{const h=St(),[d,u]=E.useState([]),[f,g]=E.useState(!1),[p,m]=E.useState({}),[w,T]=E.useState(""),_=r.name==="Couple";E.useEffect(()=>{_&&!i.decoration&&a(y=>({...y,decoration:!0}))},[_,i.decoration,a]),E.useEffect(()=>{(async()=>{if(!l||!e){u([]);return}try{if(g(!0),!xt(l)){m(C=>({...C,selectedDate:"Please select a valid future date"}));return}const{data:x,error:O}=await Ze.rpc("get_available_slots",{p_venue_id:e,p_date:l});if(O)throw console.error("Error fetching available slots:",O),O;const U=(x||[]).map(C=>({slot_id:C.slot_id,start_time:j(C.start_time),end_time:j(C.end_time)}));u(U),U.length>0?U.find(C=>C.slot_id===i.slotId)||a(C=>({...C,slotId:U[0].slot_id})):a(C=>({...C,slotId:""}))}catch(x){console.error("Error fetching available slots:",x),u([]),a(O=>({...O,slotId:""}))}finally{g(!1)}})()},[l,e,a]);const j=y=>{const[x,O]=y.split(":"),U=parseInt(x),C=U>=12?"PM":"AM";return`${U%12||12}:${O} ${C}`},S=()=>{const y=d.find(x=>x.slot_id===i.slotId);return y?`${y.start_time} - ${y.end_time}`:""},P=y=>y?new Date(y).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",J=()=>{const y={};return l?xt(l)||(y.selectedDate="Please select a valid future date"):y.selectedDate="Please select a booking date",i.slotId?Nn(i.slotId)||(y.slotId="Please select a valid time slot"):y.slotId="Please select a time slot",i.bookingName.trim()?Xt(i.bookingName)||(y.bookingName="Booking name must be between 2-50 characters"):y.bookingName="Please enter a booking name",i.persons?Tn(parseInt(i.persons),r.base_members)||(y.persons=`Number of persons must be between 1 and ${r.base_members}`):y.persons="Please select number of persons",i.whatsapp?Yt(i.whatsapp)||(y.whatsapp="Please enter a valid 10-digit WhatsApp number"):y.whatsapp="Please enter a WhatsApp number",i.email.trim()?Qt(i.email)||(y.email="Please enter a valid email address"):y.email="Please enter an email address",m(y),Object.keys(y).length===0},re=y=>{y.preventDefault();const x=`${i.email||"anonymous"}_${Date.now()}`;if(!kt.isAllowed(x)){const U=Math.ceil(kt.getRemainingTime(x)/1e3);T(`Too many requests. Please wait ${U} seconds before trying again.`);return}if(T(""),!J())return;const O={...i,bookingName:B(i.bookingName),email:B(i.email),whatsapp:B(i.whatsapp)};t({...O,selectedDate:l,selectedSlot:S()})},pe=y=>{const x=y.target.value.replace(/\D/g,"");x.length<=10&&(a({...i,whatsapp:x}),p.whatsapp&&m(O=>({...O,whatsapp:""})))},M=(y,x)=>{const O=typeof x=="string"?B(x):x;a({...i,[y]:O}),p[y]&&m(U=>({...U,[y]:""}))};return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Overview"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-pink-500/20 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-pink-500 text-sm",children:"🏢"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Venue"}),o.jsx("p",{className:"text-white font-medium",children:r.name})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-pink-500/20 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-pink-500 text-sm",children:"📅"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Date"}),o.jsx("p",{className:"text-white font-medium text-xs sm:text-sm",children:l?P(l):"Select date"})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-pink-500/20 rounded-lg flex items-center justify-center",children:o.jsx("span",{className:"text-pink-500 text-sm",children:"⏰"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Slot"}),o.jsx("p",{className:"text-white font-medium text-xs sm:text-sm",children:S()||"Select slot"})]})]})]})]}),w&&o.jsx("div",{className:"bg-red-500/20 border border-red-500/50 rounded-lg p-4",children:o.jsx("p",{className:"text-red-400 text-sm",role:"alert",children:w})}),o.jsxs("form",{onSubmit:re,className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Booking Details"}),o.jsx("span",{className:"text-sm text-gray-400",children:"1 of 4"})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Booking Date*"}),o.jsx("input",{type:"date",required:!0,value:l,onChange:y=>{c(y.target.value),p.selectedDate&&m(x=>({...x,selectedDate:""}))},min:new Date().toISOString().split("T")[0],className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Select booking date"}),p.selectedDate&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.selectedDate})]}),l&&o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Available Slots*"}),f?o.jsx("div",{className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-gray-400",children:"Loading available slots..."}):o.jsxs("select",{required:!0,value:i.slotId,onChange:y=>M("slotId",y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Select time slot",children:[o.jsx("option",{value:"",children:"Select a slot"}),d.map(y=>o.jsxs("option",{value:y.slot_id,children:[y.start_time," - ",y.end_time]},y.slot_id))]}),p.slotId&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.slotId}),d.length===0&&!f&&l&&o.jsx("p",{className:"text-red-400 text-sm mt-1",children:"No slots available for this date. Please select another date."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Booking Name*"}),o.jsx("input",{type:"text",required:!0,value:i.bookingName,onChange:y=>M("bookingName",y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter booking name","aria-label":"Enter booking name",maxLength:50}),p.bookingName&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.bookingName})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Number of Persons*"}),o.jsx("select",{required:!0,value:i.persons,onChange:y=>M("persons",y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Select number of persons",children:[...Array(r.base_members)].map((y,x)=>o.jsxs("option",{value:x+1,children:[x+1," Person",x!==0?"s":""]},x+1))}),p.persons&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.persons})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"WhatsApp Number*"}),o.jsx("input",{type:"tel",required:!0,value:i.whatsapp,onChange:pe,className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter 10-digit WhatsApp number","aria-label":"Enter WhatsApp number",maxLength:10,minLength:10}),p.whatsapp&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.whatsapp}),i.whatsapp.length>0&&i.whatsapp.length<10&&!p.whatsapp&&o.jsx("p",{className:"text-yellow-400 text-sm mt-1",children:"Please enter exactly 10 digits"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email ID*"}),o.jsx("input",{type:"email",required:!0,value:i.email,onChange:y=>M("email",y.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter email address","aria-label":"Enter email address",maxLength:100}),p.email&&o.jsx("p",{className:"text-red-400 text-sm mt-1",role:"alert",children:p.email})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Do you want decoration?*"}),_?o.jsx("div",{className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white",children:"Yes (Mandatory for Couple venue)"}):o.jsxs("select",{required:!0,value:i.decoration?"yes":"no",onChange:y=>a({...i,decoration:y.target.value==="yes"}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Select decoration option",children:[o.jsx("option",{value:"no",children:"No"}),o.jsx("option",{value:"yes",children:"Yes"})]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mt-6",children:[o.jsx("button",{type:"button",onClick:()=>h("/"),className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold","aria-label":"Go back to home page",children:"Back to Home"}),o.jsx("button",{type:"submit",disabled:s,className:`bg-pink-600 hover:bg-pink-700 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold ${s?"opacity-50 cursor-not-allowed":""}`,"aria-label":"Proceed to event selection",children:s?"Processing...":"Next: Select Event Type"})]}),n&&o.jsx("p",{className:"mt-4 text-red-500 text-center",role:"alert",children:n})]})]})},Pn=({venue:r,formData:e,selectedCakes:t=[],selectedAddOns:s=[]})=>{const n=r.price,i=e!=null&&e.decoration?400:0,a=t.reduce((u,f)=>u+f.price*f.quantity,0),l=s.reduce((u,f)=>{const g=et.find(p=>p.name===f);return u+(g?g.price:0)},0),c=n+i+a+l,h=700,d=c-h;return o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6 sticky top-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:"Booking Summary"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[o.jsx("span",{className:"text-gray-300",children:"Base Price"}),o.jsxs("span",{className:"text-white font-medium flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),n]})]}),o.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[o.jsx("span",{className:"text-gray-300",children:"Decoration"}),o.jsxs("span",{className:"text-white font-medium flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),i]})]}),a>0&&o.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[o.jsx("span",{className:"text-gray-300",children:"Cakes"}),o.jsxs("span",{className:"text-white font-medium flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),a]})]}),l>0&&o.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[o.jsx("span",{className:"text-gray-300",children:"Add-ons"}),o.jsxs("span",{className:"text-white font-medium flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),l]})]}),o.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-700",children:[o.jsx("span",{className:"text-gray-300",children:"Advance Amount Payable"}),o.jsxs("div",{className:"text-right",children:[o.jsxs("span",{className:"text-white font-medium flex items-center justify-end",children:[o.jsx(R,{className:"h-4 w-4"}),h]}),o.jsx("p",{className:"text-xs text-gray-400",children:"(Including ₹50/- convenience fee)"})]})]}),o.jsxs("div",{className:"flex justify-between items-center py-2",children:[o.jsx("span",{className:"text-gray-300",children:"Balance Amount"}),o.jsxs("div",{className:"text-right",children:[o.jsxs("span",{className:"text-white font-medium flex items-center justify-end",children:[o.jsx(R,{className:"h-4 w-4"}),d]}),o.jsx("p",{className:"text-xs text-gray-400",children:"(Final amount negotiable — to be paid at venue)"})]})]})]})]})},An=({selectedEventType:r,onEventTypeSelect:e,onNext:t,onBack:s})=>o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Step 1: Select Event Type"}),o.jsx("span",{className:"text-sm text-gray-400",children:"1 of 4"})]}),o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 md:gap-6 mb-8",children:ns.map(n=>o.jsxs("div",{onClick:()=>e(n.name),className:`cursor-pointer rounded-xl overflow-hidden transition-all duration-300 ${r===n.name?"ring-2 ring-pink-500 bg-pink-500/10":"bg-gray-800/50 hover:bg-gray-700/50"}`,children:[o.jsx("div",{className:"aspect-square relative overflow-hidden rounded-lg mb-3",children:o.jsx("img",{src:n.icon,alt:n.name,loading:"lazy",className:"w-full h-full object-cover"})}),o.jsx("div",{className:"p-3 text-center",children:o.jsx("h3",{className:"text-white font-medium text-sm",children:n.name})})]},n.id))}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[o.jsx("button",{onClick:s,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Back"}),o.jsx("button",{onClick:t,disabled:!r,className:`py-3 px-6 rounded-lg transition-colors duration-300 font-bold ${r?"bg-pink-600 hover:bg-pink-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:"Next: Select Cake"})]})]}),$n=({selectedCakes:r,onCakeSelect:e,onNext:t,onBack:s})=>{const[n,i]=E.useState("egg"),[a,l]=E.useState("halfKg"),c=u=>{const f=u.prices[n][a],g=`${u.name}-${n}-${a}`,p=r.findIndex(m=>`${m.name}-${m.type}-${m.weight}`===g);if(p>=0){const m=r.filter((w,T)=>T!==p);e(m)}else{const m={name:u.name,type:n,weight:a,price:f,quantity:1};e([...r,m])}},h=(u,f)=>{if(!(f<0))if(f===0){const g=r.filter((p,m)=>m!==u);e(g)}else{const g=r.map((p,m)=>m===u?{...p,quantity:f}:p);e(g)}},d=u=>{const f=`${u.name}-${n}-${a}`;return r.some(g=>`${g.name}-${g.type}-${g.weight}`===f)};return o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Step 2: Select Cake (Optional)"}),o.jsx("span",{className:"text-sm text-gray-400",children:"2 of 4"})]}),o.jsx("div",{className:"flex justify-center gap-4 mb-8",children:o.jsxs("div",{className:"flex items-center gap-4 bg-gray-800/50 rounded-lg p-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),o.jsxs("select",{value:n,onChange:u=>i(u.target.value),className:"bg-gray-700 text-white rounded-lg px-4 py-2",children:[o.jsx("option",{value:"egg",children:"Egg"}),o.jsx("option",{value:"eggless",children:"Eggless"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Weight"}),o.jsxs("select",{value:a,onChange:u=>l(u.target.value),className:"bg-gray-700 text-white rounded-lg px-4 py-2",children:[o.jsx("option",{value:"halfKg",children:"½ kg"}),o.jsx("option",{value:"oneKg",children:"1 kg"})]})]})]})}),o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:is.map(u=>o.jsxs("div",{onClick:()=>c(u),className:`cursor-pointer rounded-xl overflow-hidden transition-all duration-300 ${d(u)?"ring-2 ring-pink-500 bg-pink-500/10":"bg-gray-800/50 hover:bg-gray-700/50"}`,children:[o.jsxs("div",{className:"aspect-square relative overflow-hidden",children:[o.jsx("img",{src:u.image,alt:u.name,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),d(u)&&o.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white text-sm font-bold",children:"✓"})})]}),o.jsxs("div",{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:u.name}),o.jsxs("p",{className:"text-pink-500 font-bold",children:["₹",u.prices[n][a]]})]})]},u.id))}),r.length>0&&o.jsxs("div",{className:"mb-8 bg-gray-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"Selected Cakes:"}),o.jsx("div",{className:"space-y-3",children:r.map((u,f)=>o.jsxs("div",{className:"flex items-center justify-between bg-gray-600/30 rounded-lg p-3",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-white font-medium",children:u.name}),o.jsxs("p",{className:"text-gray-400 text-sm",children:[u.type==="egg"?"Egg":"Eggless"," • ",u.weight==="halfKg"?"½ kg":"1 kg"]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:g=>{g.stopPropagation(),h(f,u.quantity-1)},className:"w-8 h-8 bg-gray-600 hover:bg-gray-500 text-white rounded-full flex items-center justify-center",children:"-"}),o.jsx("span",{className:"text-white font-medium w-8 text-center",children:u.quantity}),o.jsx("button",{onClick:g=>{g.stopPropagation(),h(f,u.quantity+1)},className:"w-8 h-8 bg-gray-600 hover:bg-gray-500 text-white rounded-full flex items-center justify-center",children:"+"})]}),o.jsxs("span",{className:"text-pink-500 font-bold",children:["₹",u.price*u.quantity]})]})]},f))})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[o.jsx("button",{onClick:s,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Back"}),o.jsx("button",{onClick:t,className:"bg-pink-600 hover:bg-pink-700 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Next: Select Add-ons"})]})]})},On=({selectedAddOns:r,onAddOnToggle:e,onNext:t,onBack:s})=>o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Step 3: Select Add-ons"}),o.jsx("span",{className:"text-sm text-gray-400",children:"3 of 4"})]}),o.jsx("p",{className:"text-gray-400 mb-6 text-center",children:"Select multiple add-ons to enhance your celebration (optional)"}),o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-8",children:et.map(n=>o.jsxs("div",{onClick:()=>e(n.name),className:`cursor-pointer rounded-xl overflow-hidden transition-all duration-300 ${r.includes(n.name)?"ring-2 ring-pink-500 bg-pink-500/10":"bg-gray-800/50 hover:bg-gray-700/50"}`,children:[o.jsxs("div",{className:"aspect-square relative overflow-hidden",children:[o.jsx("img",{src:n.image,alt:n.name,loading:"lazy",className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),r.includes(n.name)&&o.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white text-sm font-bold",children:"✓"})})]}),o.jsxs("div",{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:n.name}),o.jsxs("p",{className:"text-pink-500 font-bold",children:["₹",n.price]})]})]},n.id))}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[o.jsx("button",{onClick:s,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Back"}),o.jsx("button",{onClick:t,className:"bg-pink-600 hover:bg-pink-700 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Next: Review & Pay"})]})]}),Cn=({isOpen:r,onClose:e,onAccept:t})=>{const[s,n]=E.useState(!1),[i,a]=E.useState(!1);if(!r)return null;const l=()=>{if(!s){a(!0);return}t()},c=h=>{n(h.target.checked),h.target.checked&&a(!1)};return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80",children:o.jsxs("div",{className:"relative bg-gray-800 rounded-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"sticky top-0 bg-gray-800 p-6 border-b border-gray-700 flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"Terms & Conditions and Refund Policy"}),o.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx(as,{className:"h-6 w-6"})})]}),o.jsxs("div",{className:"p-6 space-y-8 text-gray-300",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Terms & Conditions"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{children:"1. We do NOT provide any movie/OTT accounts. We will do the setups using your OTT accounts/downloaded content."}),o.jsx("p",{children:"2. Smoking/Drinking is NOT allowed inside the theater."}),o.jsx("p",{children:"3. Any DAMAGE caused to theater, including decorative materials like balloons, lights etc. will have to be reimbursed."}),o.jsx("p",{children:"4. Guests are requested to maintain CLEANLINESS inside the theater."}),o.jsx("p",{children:"5. Party poppers/Snow sprays/Cold Fire, and any other similar items are strictly prohibited inside the theater."}),o.jsx("p",{children:"6. Carrying AADHAAR CARD is mandatory. It will be scanned during entry."}),o.jsx("p",{children:"7. Couples under 18 years of age are not allowed to book the theatre."}),o.jsx("p",{children:"8. Pets are strictly not allowed inside the theatre."})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Refund Policy"}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{children:"Advance amount is fully refundable if slot is cancelled at least 72 hrs before the slot time."}),o.jsx("p",{children:"If your slot is less than 72 hrs away from time of payment, then advance is non-refundable."})]})]}),o.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("input",{type:"checkbox",id:"terms-accept",checked:s,onChange:c,className:"mt-1 h-4 w-4 text-pink-600 bg-gray-700 border-gray-600 rounded focus:ring-pink-500 focus:ring-2"}),o.jsx("label",{htmlFor:"terms-accept",className:"text-white text-sm",children:"I have read and agree to the Terms & Conditions and Refund Policy"})]}),i&&o.jsxs("div",{className:"mt-3 flex items-center gap-2 text-red-400 text-sm",children:[o.jsx(cs,{className:"h-4 w-4"}),o.jsx("span",{children:"Please accept the terms before continuing."})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-end pt-4 border-t border-gray-700",children:[o.jsx("button",{onClick:e,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Cancel"}),o.jsx("button",{onClick:l,className:"bg-pink-600 hover:bg-pink-700 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Continue to Payment"})]})]})]})})},Rn=({venue:r,formData:e,selectedDate:t,selectedSlot:s,eventType:n,selectedCakes:i,selectedAddOns:a,onBack:l,onConfirmBooking:c,loading:h})=>{const[d,u]=os.useState(!1),f=_=>new Date(_).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),g=_=>{const j=et.find(S=>S.name===_);return j?j.price:0},m=(()=>{const _=r.price,j=e.decoration?400:0,S=i.reduce((M,y)=>M+y.price*y.quantity,0),P=a.reduce((M,y)=>M+g(y),0),J=_+j+S+P,re=700,pe=J-re;return{basePrice:_,decorationFee:j,cakesTotal:S,addOnsTotal:P,subtotal:J,advanceAmount:re,balanceAmount:pe}})(),w=()=>{u(!0)},T=()=>{u(!1),c()};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 md:p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Step 4: Review & Confirm"}),o.jsx("span",{className:"text-sm text-gray-400",children:"4 of 4"})]}),o.jsxs("div",{className:"space-y-6 mb-8",children:[o.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Booking Details"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Venue:"}),o.jsx("span",{className:"text-white font-medium",children:r.name})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Date:"}),o.jsx("span",{className:"text-white font-medium",children:f(t)})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Time:"}),o.jsx("span",{className:"text-white font-medium",children:s})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Persons:"}),o.jsx("span",{className:"text-white font-medium",children:e.persons})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Contact:"}),o.jsx("span",{className:"text-white font-medium",children:e.whatsapp})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Event Type:"}),o.jsx("span",{className:"text-white font-medium",children:n})]})]})]}),i.length>0&&o.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Cake Selection"}),o.jsx("div",{className:"space-y-2",children:i.map((_,j)=>o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-white font-medium",children:_.name}),o.jsxs("p",{className:"text-gray-400 text-sm",children:[_.type==="egg"?"Egg":"Eggless"," • ",_.weight==="halfKg"?"½ kg":"1 kg"," • Qty: ",_.quantity]})]}),o.jsxs("span",{className:"text-pink-500 font-bold flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),_.price*_.quantity]})]},j))})]}),a.length>0&&o.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Selected Add-ons"}),o.jsx("div",{className:"space-y-2",children:a.map((_,j)=>o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-white",children:_}),o.jsxs("span",{className:"text-pink-500 font-bold flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),g(_)]})]},j))})]}),o.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Bill Summary"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("span",{className:"text-gray-300",children:["Base Price (",r.name,")"]}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.basePrice]})]}),m.decorationFee>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Decoration"}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.decorationFee]})]}),m.cakesTotal>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Cakes"}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.cakesTotal]})]}),m.addOnsTotal>0&&o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Add-ons"}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.addOnsTotal]})]}),o.jsx("div",{className:"border-t border-gray-600 pt-2 mt-2",children:o.jsxs("div",{className:"flex justify-between font-bold",children:[o.jsx("span",{className:"text-white",children:"Total Amount"}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.subtotal]})]})}),o.jsxs("div",{className:"flex justify-between text-pink-500 font-bold",children:[o.jsx("span",{children:"Advance Amount Payable"}),o.jsxs("span",{className:"flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.advanceAmount]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Balance Amount"}),o.jsxs("span",{className:"text-white flex items-center",children:[o.jsx(R,{className:"h-4 w-4"}),m.balanceAmount]})]}),o.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Balance amount to be paid at venue"})]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[o.jsx("button",{onClick:l,className:"bg-gray-700 hover:bg-gray-600 text-white py-3 px-6 rounded-lg transition-colors duration-300 font-bold",children:"Back"}),o.jsx("button",{onClick:w,disabled:h,className:`py-3 px-6 rounded-lg transition-colors duration-300 font-bold ${h?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-pink-600 hover:bg-pink-700 text-white"}`,children:h?"Processing...":"Confirm & Pay Advance"})]})]}),o.jsx(Cn,{isOpen:d,onClose:()=>u(!1),onAccept:T})]})},Gn=()=>{const[r]=ls(),e=St(),[t,s]=E.useState(""),[n,i]=E.useState(null),[a,l]=E.useState(!1),[c,h]=E.useState(null),[d,u]=E.useState("booking"),[f,g]=E.useState({bookingName:"",persons:"1",whatsapp:"",email:"",decoration:!1,slotId:""}),[p,m]=E.useState(""),[w,T]=E.useState(""),[_,j]=E.useState(""),[S,P]=E.useState([]),[J,re]=E.useState([]);E.useEffect(()=>{(async()=>{try{const $=r.get("venue");if(!$){h("No venue selected");return}s($);const{data:X,error:ne}=await Ze.from("venues").select("*").eq("id",$).maybeSingle();if(ne){console.error("Error fetching venue:",ne),h("Error loading venue details");return}if(!X){h("Venue not found");return}i(X),h(null)}catch($){console.error("Error in venue initialization:",$),h("Failed to load venue details")}})()},[r]);const pe=N=>{g(N),m(N.selectedDate),T(N.selectedSlot),u("event-type")},M=()=>u("cake"),y=()=>u("addons"),x=()=>u("summary"),O=N=>{re($=>$.includes(N)?$.filter(X=>X!==N):[...$,N])},U=()=>{const N=[];return Xt(f.bookingName)||N.push("Invalid booking name"),Qt(f.email)||N.push("Invalid email address"),Yt(f.whatsapp)||N.push("Invalid phone number"),(!p||!f.slotId)&&N.push("Missing date or slot selection"),_||N.push("Please select an event type"),N},C=async N=>{try{const $=S.length>0?S.map(K=>`${B(K.name)} (${K.type}, ${K.weight}) x${K.quantity}`).join(", "):"",X=J.map(K=>B(K)).join(", "),ne={venue_id:t,slot_id:f.slotId,booking_date:p,booking_name:B(f.bookingName),persons:parseInt(f.persons),whatsapp:B(f.whatsapp),email:B(f.email),decoration:f.decoration,advance_paid:!0,payment_id:N,event_type:B(_),cake_selection:$,selected_addons:X},{data:ot,error:ie}=await Ze.functions.invoke("secure-booking",{body:ne});if(ie)throw ie;return ot}catch($){throw console.error("Secure booking API error:",$),$}},at=async()=>{l(!0),h(null);try{const N=`${f.email}_booking`;if(!jt.isAllowed(N)){const ie=Math.ceil(jt.getRemainingTime(N)/1e3);throw new Error(`Too many booking attempts. Please wait ${ie} seconds before trying again.`)}const $=U();if($.length>0)throw new Error($.join(", "));const ne={key:"rzp_test_1DP5mmOlF5G5ag",amount:700*100,currency:"INR",name:"Binge'N Celebration",description:`Booking for ${n.name}`,image:"/BINGEN.png",handler:async ie=>{try{l(!0),await C(ie.razorpay_payment_id),e("/booking-success")}catch(K){console.error("Error after payment:",K),h("Payment successful but booking failed. Please contact support.")}finally{l(!1)}},prefill:{name:B(f.bookingName),email:B(f.email),contact:B(f.whatsapp)},theme:{color:"#DB2777"},modal:{ondismiss:()=>{l(!1),h("Payment was cancelled. Please try again.")}}};new window.Razorpay(ne).open()}catch(N){console.error("Error in booking process:",N),h(N.message),l(!1)}},ke=()=>{switch(d){case"event-type":u("booking");break;case"cake":u("event-type");break;case"addons":u("cake");break;case"summary":u("addons");break;default:u("booking")}};if(!n)return o.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:o.jsx("div",{className:"text-white text-xl",children:c||"Loading venue details..."})});const De=d!=="summary";return o.jsx("div",{className:"min-h-screen bg-gray-900 py-4 md:py-8 lg:py-12",children:o.jsx("div",{className:"container mx-auto px-4 md:px-6",children:o.jsxs("div",{className:"max-w-6xl mx-auto",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6 md:mb-8",children:[o.jsx("img",{src:"/BINGEN.png",alt:"Binge'N Celebration Logo",className:"h-8 md:h-10 lg:h-12 w-8 md:w-10 lg:w-12"}),o.jsx("h1",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-white",children:"Complete Your Booking"})]}),o.jsxs("div",{className:`grid gap-6 md:gap-8 ${De?"lg:grid-cols-3":"lg:grid-cols-1"}`,children:[o.jsxs("div",{className:De?"lg:col-span-2":"lg:col-span-1",children:[d==="booking"&&o.jsx(En,{venue:n,venueId:t,onSubmit:pe,loading:a,error:c,formData:f,setFormData:g,selectedDate:p,setSelectedDate:m}),d==="event-type"&&o.jsx(An,{selectedEventType:_,onEventTypeSelect:j,onNext:M,onBack:ke}),d==="cake"&&o.jsx($n,{selectedCakes:S,onCakeSelect:P,onNext:y,onBack:ke}),d==="addons"&&o.jsx(On,{selectedAddOns:J,onAddOnToggle:O,onNext:x,onBack:ke}),d==="summary"&&o.jsx(Rn,{venue:n,formData:f,selectedDate:p,selectedSlot:w,eventType:_,selectedCakes:S,selectedAddOns:J,onBack:ke,onConfirmBooking:at,loading:a})]}),De&&o.jsx("div",{className:"lg:col-span-1",children:o.jsx(Pn,{venue:n,formData:f,selectedCakes:S,selectedAddOns:J})})]}),c&&o.jsx("div",{className:"mt-6 bg-red-500/20 border border-red-500/50 rounded-lg p-4",children:o.jsx("p",{className:"text-red-400 text-center",role:"alert",children:c})})]})})})};export{Gn as default};
